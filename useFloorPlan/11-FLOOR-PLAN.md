# 11 - ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³æ©Ÿèƒ½

## Claude Code Implementation Guide - Floor Plan Feature

> **Note**: ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³ã¯ã‚ªãƒ•ã‚£ã‚¹ãƒ“ãƒ«å‘ã‘ã®**ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½**ã§ã™ã€‚
> ä¼šç¤¾ã® `features.floor_plan` ãŒ `true` ã®å ´åˆã®ã¿æœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚

---

## âš ï¸ Claude Code ã¸ã®æœ€é‡è¦æŒ‡ç¤º

**ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã ã‚‰ã€ä»¥ä¸‹ã®å‚ç…§ã‚³ãƒ¼ãƒ‰ã‚‚å¿…ãšç¢ºèªã—ã¦ãã ã•ã„ï¼š**

- `useFloorPlan/LinearFloorPlan.tsx` - é¢ç©ãƒ™ãƒ¼ã‚¹ä¸€åˆ—è¡¨ç¤º
- `useFloorPlan/UnitBlock.tsx` - éƒ¨å±‹ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆãƒªãƒ³ã‚¯ä»˜ãï¼‰
- `useFloorPlan/page.tsx` - çµ±åˆãƒšãƒ¼ã‚¸

### ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³æ©Ÿèƒ½ã¨ã¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³ã¯ã€Œè¦–è¦šçš„ãªéƒ¨å±‹é…ç½®å›³ã€æ©Ÿèƒ½                    â”‚
â”‚                                                             â”‚
â”‚  ä¸»ãªç”¨é€”:                                                  â”‚
â”‚  â€¢ ã‚ªãƒ•ã‚£ã‚¹ãƒ“ãƒ«ã®å„éšãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’è¦–è¦šåŒ–                     â”‚
â”‚  â€¢ éƒ¨å±‹ã®ä½ç½®ãƒ»ã‚µã‚¤ã‚ºã‚’ç›´æ„Ÿçš„ã«æŠŠæ¡                         â”‚
â”‚  â€¢ å…¥å±…çŠ¶æ³ã‚’è‰²åˆ†ã‘ã§ä¸€ç›®ã§ç¢ºèª                             â”‚
â”‚  â€¢ ç©ºå®¤ãƒ»å…¥å±…ä¸­ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ãªã©ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º       â”‚
â”‚  â€¢ éƒ¨å±‹ã‹ã‚‰å…¥å±…è€…ãƒ»å¥‘ç´„è©³ç´°ã¸ç›´æ¥ã‚¸ãƒ£ãƒ³ãƒ—                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã„ã¤ä½¿ã†æ©Ÿèƒ½ã‹

| ç‰©ä»¶ã‚¿ã‚¤ãƒ—         | ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³ | ç†ç”±                             |
| ------------------ | :----------: | -------------------------------- |
| ã‚ªãƒ•ã‚£ã‚¹ãƒ“ãƒ«       |   âœ… æ¨å¥¨    | å„éšã«å¤šæ•°ã®ãƒ†ãƒŠãƒ³ãƒˆã€é…ç½®ãŒé‡è¦ |
| å•†æ¥­æ–½è¨­           |   âœ… æ¨å¥¨    | åº—èˆ—é…ç½®ã®å¯è¦–åŒ–ãŒå¿…è¦           |
| ã‚¢ãƒ‘ãƒ¼ãƒˆï¼ˆå°è¦æ¨¡ï¼‰ |   âš ï¸ ä»»æ„    | éƒ¨å±‹æ•°ãŒå°‘ãªã„å ´åˆã¯ä¸è¦         |
| ã‚¢ãƒ‘ãƒ¼ãƒˆï¼ˆå¤§è¦æ¨¡ï¼‰ |   âœ… æ¨å¥¨    | 100 å®¤ä»¥ä¸Šãªã‚‰è¦–è¦šåŒ–ãŒä¾¿åˆ©       |

---

## 1. æ©Ÿèƒ½æ¦‚è¦

### 1.1 ä¸»ãªç”»é¢

```
ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³æ©Ÿèƒ½
â”œâ”€â”€ é–²è¦§ãƒ¢ãƒ¼ãƒ‰ï¼ˆFloorPlanViewerï¼‰
â”‚   â”œâ”€â”€ éšé¸æŠ
â”‚   â”œâ”€â”€ éƒ¨å±‹ã®è¦–è¦šè¡¨ç¤º
â”‚   â”œâ”€â”€ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è‰²åˆ†ã‘
â”‚   â””â”€â”€ éƒ¨å±‹è©³ç´°è¡¨ç¤º
â”‚
â””â”€â”€ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼ˆFloorPlanEditorï¼‰
    â”œâ”€â”€ éšã®è¿½åŠ ãƒ»å‰Šé™¤
    â”œâ”€â”€ éƒ¨å±‹ã®è¿½åŠ ãƒ»é…ç½®
    â”œâ”€â”€ ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã§ç§»å‹•
    â”œâ”€â”€ ã‚µã‚¤ã‚ºå¤‰æ›´
    â””â”€â”€ ã‚°ãƒªãƒƒãƒ‰ã‚¹ãƒŠãƒƒãƒ—
```

### 1.2 ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼

```
ç‰©ä»¶è©³ç´°ãƒšãƒ¼ã‚¸
    â†“
ã€Œãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³ã€ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³é–²è¦§ç”»é¢               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [1F] [2F] [3F] [4F]         â”‚   â”‚ â† éšé¸æŠ
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚101â”‚ â”‚102â”‚ â”‚103â”‚ â”‚104â”‚  â”‚   â”‚ â† éƒ¨å±‹ãƒ–ãƒ­ãƒƒã‚¯
â”‚  â”‚  â”‚ ç©ºâ”‚ â”‚å…¥å±…â”‚ â”‚å…¥å±…â”‚ â”‚æ•´å‚™â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚105â”‚ â”‚106â”‚ â”‚   107     â”‚â”‚   â”‚ â† ã‚µã‚¤ã‚ºã¯è‡ªç”±
â”‚  â”‚  â”‚å…¥å±…â”‚ â”‚ ç©ºâ”‚ â”‚   å…¥å±…     â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  [ç·¨é›†ãƒ¢ãƒ¼ãƒ‰] ãƒœã‚¿ãƒ³                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
éƒ¨å±‹ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°è¡¨ç¤º
```

---

## 2. ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### 2.1 ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆ

```sql
-- éšï¼ˆfloorsï¼‰ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE floors (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    property_id UUID REFERENCES properties(id) ON DELETE CASCADE,
    floor_number INTEGER NOT NULL,
    name TEXT,                              -- "1F", "B1", "å±‹ä¸Š" ãªã©
    plan_image_url TEXT,                    -- èƒŒæ™¯ç”»åƒURLï¼ˆä»»æ„ï¼‰
    plan_width INTEGER DEFAULT 800,         -- ã‚­ãƒ£ãƒ³ãƒã‚¹å¹…
    plan_height INTEGER DEFAULT 600,        -- ã‚­ãƒ£ãƒ³ãƒã‚¹é«˜ã•
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- éƒ¨å±‹ï¼ˆunitsï¼‰ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ ã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
-- position_x INTEGER      -- Xåº§æ¨™ï¼ˆå·¦ç«¯ã‹ã‚‰ã®ãƒ”ã‚¯ã‚»ãƒ«ï¼‰
-- position_y INTEGER      -- Yåº§æ¨™ï¼ˆä¸Šç«¯ã‹ã‚‰ã®ãƒ”ã‚¯ã‚»ãƒ«ï¼‰
-- width INTEGER           -- éƒ¨å±‹ãƒ–ãƒ­ãƒƒã‚¯ã®å¹…
-- height INTEGER          -- éƒ¨å±‹ãƒ–ãƒ­ãƒƒã‚¯ã®é«˜ã•
-- floor_id UUID           -- æ‰€å±ã™ã‚‹éš
```

### 2.2 TypeScript å‹å®šç¾©

```typescript
interface Floor {
  id: string;
  property_id: string;
  floor_number: number;
  name: string | null;
  plan_image_url: string | null;
  plan_width: number;
  plan_height: number;
  created_at: string;
  updated_at: string;
}

interface Unit {
  id: string;
  property_id: string;
  floor_id: string | null;
  unit_number: string;
  floor: number;
  area_sqm: number | null;
  monthly_rent: number;
  status: "vacant" | "occupied" | "maintenance" | "reserved";
  // ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³ç”¨
  position_x: number | null;
  position_y: number | null;
  width: number | null;
  height: number | null;
}
```

---

## 3. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è‰²åˆ†ã‘

### 3.1 éƒ¨å±‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®è‰²

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹   | èƒŒæ™¯è‰²         | æ ç·šè‰²              | ãƒ¢ãƒ³ã‚´ãƒ«èª  |
| ------------ | -------------- | ------------------- | ----------- |
| ç©ºå®¤         | `bg-white`     | `border-gray-300`   | Ğ¡ÑƒĞ» Ó©Ñ€Ó©Ó©    |
| å…¥å±…ä¸­       | `bg-green-50`  | `border-green-400`  | Ğ­Ğ·ÑĞ¼ÑˆĞ¸Ğ³Ñ‡Ñ‚ÑĞ¹ |
| ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ | `bg-yellow-50` | `border-yellow-400` | Ğ—Ğ°ÑĞ²Ğ°Ñ€Ñ‚     |
| äºˆç´„æ¸ˆã¿     | `bg-purple-50` | `border-purple-400` | Ğ—Ğ°Ñ…Ğ¸Ğ°Ğ»ÑĞ°Ğ½   |
| é¸æŠä¸­       | `bg-blue-100`  | `border-blue-500`   | -           |

### 3.2 å®Ÿè£…ä¾‹

```tsx
const getUnitStyle = (unit: Unit, isSelected: boolean) => {
  if (isSelected) {
    return "border-blue-500 bg-blue-100";
  }

  switch (unit.status) {
    case "occupied":
      return "border-green-400 bg-green-50";
    case "maintenance":
      return "border-yellow-400 bg-yellow-50";
    case "reserved":
      return "border-purple-400 bg-purple-50";
    default: // vacant
      return "border-gray-300 bg-white";
  }
};
```

---

## 4. ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ©Ÿèƒ½

### 4.1 ãƒ„ãƒ¼ãƒ«ãƒãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [é¸æŠ] [ç§»å‹•] â”‚ [ã‚°ãƒªãƒƒãƒ‰ ON/OFF] â”‚ [ä¿å­˜] [é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã¸]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ãƒ„ãƒ¼ãƒ«   | èª¬æ˜                       | ã‚¢ã‚¤ã‚³ãƒ³  |
| -------- | -------------------------- | --------- |
| é¸æŠ     | éƒ¨å±‹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ç·¨é›† | `Square`  |
| ç§»å‹•     | éƒ¨å±‹ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä½ç½®å¤‰æ›´ | `Move`    |
| ã‚°ãƒªãƒƒãƒ‰ | 10px ã‚°ãƒªãƒƒãƒ‰ã«ã‚¹ãƒŠãƒƒãƒ—    | `Grid3X3` |

### 4.2 éƒ¨å±‹ã®è¿½åŠ 

```tsx
const handleAddUnit = async () => {
  const newUnit = {
    property_id: propertyId,
    floor_id: selectedFloorId,
    unit_number: generateUnitNumber(), // ä¾‹: "301"
    floor: currentFloor.floor_number,
    position_x: 50, // åˆæœŸä½ç½®
    position_y: 50,
    width: 120, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µã‚¤ã‚º
    height: 100,
    status: "vacant",
    monthly_rent: 0,
  };

  await supabase.from("units").insert(newUnit);
};
```

### 4.3 ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—

```tsx
// ã‚°ãƒªãƒƒãƒ‰ã‚¹ãƒŠãƒƒãƒ—é–¢æ•°
const GRID_SIZE = 10;
const snapToGrid = (value: number) => {
  return Math.round(value / GRID_SIZE) * GRID_SIZE;
};

// ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚
const handleDragEnd = (unitId: string, x: number, y: number) => {
  const snappedX = snapToGrid(Math.max(0, x));
  const snappedY = snapToGrid(Math.max(0, y));

  updateUnit(unitId, {
    position_x: snappedX,
    position_y: snappedY,
  });
};
```

---

## 5. é–²è¦§ãƒ¢ãƒ¼ãƒ‰æ©Ÿèƒ½

### 5.1 è¡¨ç¤ºå†…å®¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         éƒ¨å±‹ãƒ–ãƒ­ãƒƒã‚¯                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        301                    â”‚  â”‚  â† éƒ¨å±‹ç•ªå·
â”‚  â”‚        45mÂ²                   â”‚  â”‚  â† é¢ç©
â”‚  â”‚         ğŸ‘¤                    â”‚  â”‚  â† å…¥å±…ä¸­ã‚¢ã‚¤ã‚³ãƒ³
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 éƒ¨å±‹ã‚¯ãƒªãƒƒã‚¯æ™‚ã®è©³ç´°è¡¨ç¤º

```tsx
{
  selectedUnit && (
    <Card>
      <CardHeader>
        <CardTitle>{selectedUnit.unit_number} ã®è©³ç´°</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-4 gap-4">
          <div>
            <span className="text-gray-500">Ğ¢Ğ°Ğ»Ğ±Ğ°Ğ¹</span>
            <p>{selectedUnit.area_sqm}mÂ²</p>
          </div>
          <div>
            <span className="text-gray-500">Ğ¡Ğ°Ñ€Ñ‹Ğ½ Ñ‚Ò¯Ñ€ÑÑÑ</span>
            <p>â‚®{selectedUnit.monthly_rent.toLocaleString()}</p>
          </div>
          <div>
            <span className="text-gray-500">Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</span>
            <p>{getStatusLabel(selectedUnit.status)}</p>
          </div>
          <div>
            <Link
              href={`/dashboard/properties/${propertyId}/units/${selectedUnit.id}`}
            >
              <Button size="sm">è©³ç´°ã‚’è¦‹ã‚‹</Button>
            </Link>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
```

---

## 6. èƒŒæ™¯ç”»åƒæ©Ÿèƒ½

### 6.1 ãƒ•ãƒ­ã‚¢èƒŒæ™¯ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

```tsx
const handleUploadFloorImage = async (file: File) => {
  const supabase = createClient();

  // Supabase Storageã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  const fileName = `floor-plans/${propertyId}/${floorId}/${Date.now()}.${file.name
    .split(".")
    .pop()}`;
  const { data, error } = await supabase.storage
    .from("property-images")
    .upload(fileName, file);

  if (!error) {
    const {
      data: { publicUrl },
    } = supabase.storage.from("property-images").getPublicUrl(fileName);

    // ãƒ•ãƒ­ã‚¢ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°
    await supabase
      .from("floors")
      .update({ plan_image_url: publicUrl })
      .eq("id", floorId);
  }
};
```

### 6.2 èƒŒæ™¯ç”»åƒã®è¡¨ç¤º

```tsx
<div
  style={{
    width: floor.plan_width,
    height: floor.plan_height,
    backgroundImage: floor.plan_image_url
      ? `url(${floor.plan_image_url})`
      : undefined,
    backgroundSize: "cover",
    backgroundPosition: "center",
  }}
>
  {/* éƒ¨å±‹ãƒ–ãƒ­ãƒƒã‚¯ */}
</div>
```

---

## 7. å‡¡ä¾‹ï¼ˆLegendï¼‰

### 7.1 è¡¨ç¤ºä½ç½®

ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³è¡¨ç¤ºã‚¨ãƒªã‚¢ã®ä¸‹ã«å‡¡ä¾‹ã‚’è¡¨ç¤º

### 7.2 å®Ÿè£…

```tsx
export function FloorPlanLegend() {
  return (
    <Card>
      <CardContent className="py-3">
        <div className="flex flex-wrap items-center gap-4 text-sm">
          <span className="font-medium">Ğ¢Ğ°Ğ¹Ğ»Ğ±Ğ°Ñ€:</span>

          <div className="flex items-center gap-2">
            <div className="h-4 w-4 rounded border-2 border-gray-300 bg-white" />
            <span>Ğ¡ÑƒĞ» Ó©Ñ€Ó©Ó©</span>
          </div>

          <div className="flex items-center gap-2">
            <div className="h-4 w-4 rounded border-2 border-green-400 bg-green-50" />
            <span>Ğ­Ğ·ÑĞ¼ÑˆĞ¸Ğ³Ñ‡Ñ‚ÑĞ¹</span>
          </div>

          <div className="flex items-center gap-2">
            <div className="h-4 w-4 rounded border-2 border-yellow-400 bg-yellow-50" />
            <span>Ğ—Ğ°ÑĞ²Ğ°Ñ€Ñ‚</span>
          </div>

          <div className="flex items-center gap-2">
            <div className="h-4 w-4 rounded border-2 border-purple-400 bg-purple-50" />
            <span>Ğ—Ğ°Ñ…Ğ¸Ğ°Ğ»ÑĞ°Ğ½</span>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
```

---

## 8. API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### 8.1 éšï¼ˆFloorsï¼‰

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ                | èª¬æ˜             |
| -------- | ----------------------------- | ---------------- |
| GET      | `/api/properties/[id]/floors` | ç‰©ä»¶ã®å…¨éšã‚’å–å¾— |
| POST     | `/api/properties/[id]/floors` | æ–°ã—ã„éšã‚’è¿½åŠ    |
| PUT      | `/api/floors/[id]`            | éšæƒ…å ±ã‚’æ›´æ–°     |
| DELETE   | `/api/floors/[id]`            | éšã‚’å‰Šé™¤         |

### 8.2 éƒ¨å±‹ä½ç½®æ›´æ–°

```typescript
// PUT /api/units/[id]/position
interface UpdatePositionRequest {
  position_x: number;
  position_y: number;
  width?: number;
  height?: number;
}
```

---

## 9. æ©Ÿèƒ½ãƒ•ãƒ©ã‚°

### 9.1 æœ‰åŠ¹åŒ–ãƒã‚§ãƒƒã‚¯

```tsx
// Sidebar ã§æ©Ÿèƒ½ã‚’è¡¨ç¤º/éè¡¨ç¤º
const hasFloorPlan = useFeature("floor_plan");

const navItems = [
  // ...
  {
    href: "/dashboard/floor-plans",
    label: "Ğ”Ğ°Ğ²Ñ…Ñ€Ñ‹Ğ½ Ğ·ÑƒÑ€Ğ°Ğ³",
    icon: Map,
    feature: "floor_plan", // ã“ã®æ©Ÿèƒ½ãƒ•ãƒ©ã‚°ãŒtrueã®æ™‚ã®ã¿è¡¨ç¤º
  },
];
```

### 9.2 ç‰©ä»¶ã”ã¨ã®è¨­å®š

```typescript
// properties ãƒ†ãƒ¼ãƒ–ãƒ«
interface Property {
  // ...
  floor_plan_enabled: boolean; // ã“ã®ç‰©ä»¶ã§ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³æ©Ÿèƒ½ã‚’ä½¿ã†ã‹
}
```

---

## 10. ãƒ¢ãƒ³ã‚´ãƒ«èªãƒ†ã‚­ã‚¹ãƒˆ

| æ—¥æœ¬èª         | ãƒ¢ãƒ³ã‚´ãƒ«èª        |
| -------------- | ----------------- |
| ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³   | Ğ”Ğ°Ğ²Ñ…Ñ€Ñ‹Ğ½ Ğ·ÑƒÑ€Ğ°Ğ³     |
| éš             | Ğ”Ğ°Ğ²Ñ…Ğ°Ñ€            |
| éšã‚’é¸æŠ       | Ğ”Ğ°Ğ²Ñ…Ğ°Ñ€ ÑĞ¾Ğ½Ğ³Ğ¾Ñ…     |
| éšã‚’è¿½åŠ        | Ğ”Ğ°Ğ²Ñ…Ğ°Ñ€ Ğ½ÑĞ¼ÑÑ…      |
| ç·¨é›†ãƒ¢ãƒ¼ãƒ‰     | Ğ—Ğ°ÑĞ°Ñ… Ğ³Ğ¾Ñ€Ğ¸Ğ¼       |
| é–²è¦§ãƒ¢ãƒ¼ãƒ‰     | Ğ¥Ğ°Ñ€Ğ°Ñ… Ğ³Ğ¾Ñ€Ğ¸Ğ¼       |
| éƒ¨å±‹ã‚’è¿½åŠ      | Ó¨Ñ€Ó©Ó© Ğ½ÑĞ¼ÑÑ…        |
| ã‚°ãƒªãƒƒãƒ‰       | Ğ¢Ğ¾Ñ€Ğ¾Ğ½ ÑˆÑƒĞ³Ğ°Ğ¼       |
| å‡¡ä¾‹           | Ğ¢Ğ°Ğ¹Ğ»Ğ±Ğ°Ñ€           |
| ç©ºå®¤           | Ğ¡ÑƒĞ» Ó©Ñ€Ó©Ó©          |
| å…¥å±…ä¸­         | Ğ­Ğ·ÑĞ¼ÑˆĞ¸Ğ³Ñ‡Ñ‚ÑĞ¹       |
| ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ | Ğ—Ğ°ÑĞ²Ğ°Ñ€Ñ‚           |
| äºˆç´„æ¸ˆã¿       | Ğ—Ğ°Ñ…Ğ¸Ğ°Ğ»ÑĞ°Ğ½         |
| è©³ç´°ã‚’è¦‹ã‚‹     | Ğ”ÑĞ»Ğ³ÑÑ€ÑĞ½Ğ³Ò¯Ğ¹ Ñ…Ğ°Ñ€Ğ°Ñ… |
| ä¿å­˜           | Ğ¥Ğ°Ğ´Ğ³Ğ°Ğ»Ğ°Ñ…          |

---

## 11. è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰

### 11.1 2 ã¤ã®è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰

| ãƒ¢ãƒ¼ãƒ‰                | èª¬æ˜              | ç”¨é€”                   |
| --------------------- | ----------------- | ---------------------- |
| **Ğ’Ğ¸Ğ·ÑƒĞ°Ğ» Ñ…Ğ°Ñ€Ğ°Ğ³Ğ´Ğ°Ñ†**   | 2D é…ç½®å›³ï¼ˆå¾“æ¥ï¼‰ | å®Ÿéš›ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ç¢ºèª |
| **Ğ–Ğ°Ğ³ÑĞ°Ğ°Ğ»Ñ‚ Ñ…Ğ°Ñ€Ğ°Ğ³Ğ´Ğ°Ñ†** | ä¸€åˆ—è¡¨ç¤º          | é¢ç©æ¯”è¼ƒã€ä¸€è¦§ç¢ºèª     |

### 11.2 ä¸€åˆ—è¡¨ç¤ºï¼ˆLinearFloorPlanï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰: [Ğ¢Ğ°Ğ»Ğ±Ğ°Ğ¹Ğ³Ğ°Ğ°Ñ€] [Ğ–Ğ¸Ğ³Ğ´]    ä¸¦æ›¿: [é¢ç©â–¾]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   301    â”‚ â”‚       302         â”‚ â”‚  303  â”‚ â”‚ 304 â”‚      â”‚
â”‚  â”‚   25mÂ²   â”‚ â”‚       85mÂ²        â”‚ â”‚ 40mÂ²  â”‚ â”‚20mÂ² â”‚      â”‚
â”‚  â”‚   ç©ºå®¤   â”‚ â”‚   ABC ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸     â”‚ â”‚ å…¥å±…  â”‚ â”‚æ•´å‚™ â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜      â”‚
â”‚       â†‘              â†‘                 â†‘         â†‘         â”‚
â”‚     å°ã•ã„         å¤§ãã„            ä¸­é–“      å°ã•ã„       â”‚
â”‚     (é¢ç©ã«æ¯”ä¾‹ã—ãŸå¹…)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.3 ä¸¦ã³æ›¿ãˆã‚ªãƒ—ã‚·ãƒ§ãƒ³

```typescript
type SortOption =
  | "unit_number" // Ó¨Ñ€Ó©Ó©Ğ½Ğ¸Ğ¹ Ğ´ÑƒĞ³Ğ°Ğ°Ñ€
  | "area_desc" // Ğ¢Ğ°Ğ»Ğ±Ğ°Ğ¹ (Ğ˜Ñ… â†’ Ğ‘Ğ°Ğ³Ğ°)
  | "area_asc" // Ğ¢Ğ°Ğ»Ğ±Ğ°Ğ¹ (Ğ‘Ğ°Ğ³Ğ° â†’ Ğ˜Ñ…)
  | "rent_desc" // Ğ¢Ò¯Ñ€ÑÑÑ (Ğ˜Ñ… â†’ Ğ‘Ğ°Ğ³Ğ°)
  | "rent_asc" // Ğ¢Ò¯Ñ€ÑÑÑ (Ğ‘Ğ°Ğ³Ğ° â†’ Ğ˜Ñ…)
  | "status"; // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
```

### 11.4 é¢ç©ã«æ¯”ä¾‹ã—ãŸå¹…ã®è¨ˆç®—

```typescript
const getProportionalWidth = (unit: Unit, maxArea: number) => {
  const area = unit.area_sqm || 50;
  const minWidth = 100;
  const maxWidth = 300;
  return Math.max(minWidth, Math.min(maxWidth, (area / maxArea) * maxWidth));
};
```

---

## 12. éƒ¨å±‹ã‹ã‚‰ã®ãƒªãƒ³ã‚¯æ©Ÿèƒ½

### 12.1 ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—å†…ãƒªãƒ³ã‚¯

éƒ¨å±‹ã‚’ãƒ›ãƒãƒ¼ã™ã‚‹ã¨ã€ä»¥ä¸‹ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  301                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:     Ğ­Ğ·ÑĞ¼ÑˆĞ¸Ğ³Ñ‡Ñ‚ÑĞ¹        â”‚
â”‚  Ğ¢Ğ°Ğ»Ğ±Ğ°Ğ¹:     45mÂ²               â”‚
â”‚  Ğ¢Ò¯Ñ€ÑÑÑ:     500,000â‚®           â”‚
â”‚  Ğ¢Ò¯Ñ€ÑÑÑĞ»ÑĞ³Ñ‡: ABC ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ“¦ Ó¨Ñ€Ó©Ó©Ğ½Ğ¸Ğ¹ Ğ´ÑĞ»Ğ³ÑÑ€ÑĞ½Ğ³Ò¯Ğ¹ â†’       â”‚ â†’ /dashboard/properties/[id]/units/[unitId]
â”‚  ğŸ‘¤ Ğ¢Ò¯Ñ€ÑÑÑĞ»ÑĞ³Ñ‡ Ñ…Ğ°Ñ€Ğ°Ñ… â†’          â”‚ â†’ /dashboard/tenants/[tenantId]
â”‚  ğŸ“„ Ğ“ÑÑ€ÑÑ Ñ…Ğ°Ñ€Ğ°Ñ… â†’               â”‚ â†’ /dashboard/leases/[leaseId]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.2 ãƒªãƒ³ã‚¯ã®è¡¨ç¤ºæ¡ä»¶

| ãƒªãƒ³ã‚¯     | è¡¨ç¤ºæ¡ä»¶                          |
| ---------- | --------------------------------- |
| éƒ¨å±‹è©³ç´°   | å¸¸ã«è¡¨ç¤º                          |
| å…¥å±…è€…è©³ç´° | `status === 'occupied' && tenant` |
| å¥‘ç´„è©³ç´°   | `lease` ãŒå­˜åœ¨ã™ã‚‹å ´åˆ            |

---

## 13. å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### åŸºæœ¬æ©Ÿèƒ½

- [ ] `floors` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] `units` ãƒ†ãƒ¼ãƒ–ãƒ«ã« `position_x`, `position_y`, `width`, `height`, `floor_id` ãŒã‚ã‚‹
- [ ] é–²è¦§ãƒ¢ãƒ¼ãƒ‰ï¼ˆFloorPlanViewerï¼‰ãŒå‹•ä½œã™ã‚‹
- [ ] ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼ˆFloorPlanEditorï¼‰ãŒå‹•ä½œã™ã‚‹
- [ ] ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã§éƒ¨å±‹ã‚’ç§»å‹•ã§ãã‚‹
- [ ] ã‚°ãƒªãƒƒãƒ‰ã‚¹ãƒŠãƒƒãƒ—ãŒå‹•ä½œã™ã‚‹
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è‰²åˆ†ã‘ãŒæ­£ã—ã„
- [ ] å‡¡ä¾‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] æ©Ÿèƒ½ãƒ•ãƒ©ã‚°ã§è¡¨ç¤º/éè¡¨ç¤ºãŒåˆ¶å¾¡ã•ã‚Œã‚‹

### è¿½åŠ æ©Ÿèƒ½

- [ ] ä¸€åˆ—è¡¨ç¤ºï¼ˆLinearFloorPlanï¼‰ãŒå‹•ä½œã™ã‚‹
- [ ] é¢ç©ã«æ¯”ä¾‹ã—ãŸå¹…ã§è¡¨ç¤ºã§ãã‚‹
- [ ] ä¸¦ã³æ›¿ãˆãŒå‹•ä½œã™ã‚‹ï¼ˆéƒ¨å±‹ç•ªå·ã€é¢ç©ã€è³ƒæ–™ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼‰
- [ ] éƒ¨å±‹ã‹ã‚‰å…¥å±…è€…è©³ç´°ã¸ãƒªãƒ³ã‚¯ã§ãã‚‹
- [ ] éƒ¨å±‹ã‹ã‚‰å¥‘ç´„è©³ç´°ã¸ãƒªãƒ³ã‚¯ã§ãã‚‹
- [ ] UI ãƒ†ã‚­ã‚¹ãƒˆãŒãƒ¢ãƒ³ã‚´ãƒ«èª

---

## 14. å‚ç…§ã‚³ãƒ¼ãƒ‰

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `/docs/reference-code/floor-plan/` ã«é…ç½®ï¼š

| ãƒ•ã‚¡ã‚¤ãƒ«              | èª¬æ˜                                 |
| --------------------- | ------------------------------------ |
| `LinearFloorPlan.tsx` | é¢ç©ãƒ™ãƒ¼ã‚¹ä¸€åˆ—è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ     |
| `UnitBlock.tsx`       | ãƒªãƒ³ã‚¯ä»˜ãéƒ¨å±‹ãƒ–ãƒ­ãƒƒã‚¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ |
| `page.tsx`            | è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿çµ±åˆãƒšãƒ¼ã‚¸             |

---

**Document Version**: 1.1  
**Previous**: `10-LOCALIZATION.md`  
**Next**: å®Ÿè£…å®Œäº† ğŸš€
